<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ìš´ì„¸ & íƒ€ë¡œ (Master Edition)</title>
    <style>
        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: #1e1e1e;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 500px;
            position: relative;
            overflow: hidden; /* ë¡œë”© ì˜¤ë²„ë ˆì´ ë“±ì„ ìœ„í•´ */
        }

        h1, h2 {
            text-align: center;
            color: #bb86fc;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #b0b0b0;
        }

        input, select, textarea, button {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #333;
            border-radius: 8px;
            background-color: #2c2c2c;
            color: #fff;
            box-sizing: border-box;
            font-size: 16px;
        }

        button {
            background-color: #bb86fc;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }

        button:hover {
            background-color: #9965f4;
        }

        .hidden {
            display: none;
        }

        /* --- íƒ­ ìŠ¤íƒ€ì¼ --- */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
        }

        .tab-btn {
            flex: 1;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #777;
            padding: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 0;
        }

        .tab-btn.active {
            color: #bb86fc;
            border-bottom-color: #bb86fc;
        }

        /* --- ì„¤ì •(ê´€ë¦¬ì) ì˜ì—­ ìŠ¤íƒ€ì¼ --- */
        #settings-area {
            background-color: #252525;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #444;
        }
        
        #toggle-settings {
            background-color: transparent;
            color: #777;
            font-size: 12px;
            padding: 5px;
            text-align: right;
            width: auto;
            float: right;
            margin-bottom: 5px;
        }

        /* --- ë¡œë”© í™”ë©´ ìŠ¤íƒ€ì¼ (ìˆ˜ì •ë¨) --- */
        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(30, 30, 30, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
        }

        /* â˜…â˜…â˜… ì´ë¯¸ì§€ ì°Œê·¸ëŸ¬ì§ ë°©ì§€ í•µì‹¬ ì½”ë“œ â˜…â˜…â˜… */
        .loading-icon {
            width: 120px;           /* í¬ê¸° ê³ ì • */
            height: 120px;          /* ê°€ë¡œì„¸ë¡œ ë™ì¼ */
            border-radius: 50%;     /* ì›í˜• */
            object-fit: cover;      /* ë¹„ìœ¨ ìœ ì§€í•˜ë©° ê½‰ ì±„ìš°ê¸° (ì°Œê·¸ëŸ¬ì§ ë°©ì§€) */
            border: 3px solid #bb86fc;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(187, 134, 252, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(187, 134, 252, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(187, 134, 252, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(187, 134, 252, 0); }
        }

        .loading-text {
            font-size: 1.2em;
            color: #fff;
            font-weight: bold;
        }

        /* --- ê²°ê³¼ ì˜ì—­ ìŠ¤íƒ€ì¼ --- */
        #result-area {
            background-color: #2c2c2c;
            padding: 20px;
            border-radius: 8px;
            line-height: 1.6;
            white-space: pre-wrap; /* ì¤„ë°”ê¿ˆ ìœ ì§€ */
            min-height: 100px;
        }
    </style>
</head>
<body>

<div class="container">
    <button id="toggle-settings" onclick="toggleSettings()">âš™ï¸ ì„¤ì • ì—´ê¸°</button>
    <div style="clear:both;"></div>

    <div id="settings-area" class="hidden">
        <h3>ğŸ”§ ê´€ë¦¬ì ì„¤ì •</h3>
        <label for="api-key">Google Gemini API Key:</label>
        <input type="password" id="api-key" placeholder="API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        
        <label for="model-select">AI ëª¨ë¸ ì„ íƒ:</label>
        <select id="model-select" onchange="saveSettings()">
            <option value="gemini-1.5-pro">Gemini 1.5 Pro (ê¸°ë³¸)</option>
            <option value="gemini-1.5-flash">Gemini 1.5 Flash (ë¹ ë¦„)</option>
            <option value="gemini-exp-1206">Gemini 2.0 Flash (Experimental)</option>
            <option value="gemini-2.5-pro">Gemini 2.5 (Future/Custom)</option>
            <option value="gemini-3-pro">Gemini 3 Pro (Future/Custom)</option>
        </select>
        
        <button onclick="saveSettings()">ì„¤ì • ì €ì¥</button>
    </div>

    <h1>ğŸ”® AI ì ìˆ ê´€</h1>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('saju')">ì‚¬ì£¼(Saju)</button>
        <button class="tab-btn" onclick="switchTab('tarot')">íƒ€ë¡œ(Tarot)</button>
    </div>

    <div id="saju-form">
        <label>ì´ë¦„</label>
        <input type="text" id="saju-name" placeholder="ì˜ˆ: í™ê¸¸ë™">
        
        <label>ìƒë…„ì›”ì¼ (YYYY-MM-DD)</label>
        <input type="date" id="saju-birth">
        
        <label>íƒœì–´ë‚œ ì‹œê°„</label>
        <div style="display:flex; gap:10px;">
            <input type="time" id="saju-time">
            <select id="saju-gender" style="width:100px;">
                <option value="male">ë‚¨ì„±</option>
                <option value="female">ì—¬ì„±</option>
            </select>
        </div>

        <label>ê³ ë¯¼/ì§ˆë¬¸ (ì„ íƒ)</label>
        <textarea id="saju-query" rows="2" placeholder="íŠ¹ë³„íˆ ê¶ê¸ˆí•œ ì ì´ ìˆë‹¤ë©´ ì ì–´ì£¼ì„¸ìš”."></textarea>
        
        <button onclick="runSaju()">ì‚¬ì£¼ ë³´ê¸°</button>
    </div>

    <div id="tarot-form" class="hidden">
        <label>íƒ€ë¡œ ì§ˆë¬¸</label>
        <textarea id="tarot-query" rows="3" placeholder="ì˜ˆ: ì§€ê¸ˆ ì¸íƒ€ëŠ” ì‚¬ëŒê³¼ ì˜ ë ê¹Œìš”?"></textarea>
        
        <label>ì¹´ë“œ ì„ íƒ ë°©ì‹</label>
        <select id="tarot-method">
            <option value="3card">3ì¹´ë“œ (ê³¼ê±°/í˜„ì¬/ë¯¸ë˜)</option>
            <option value="1card">1ì¹´ë“œ (ëª…ì¾Œí•œ ì¡°ì–¸)</option>
        </select>
        
        <button onclick="runTarot()">íƒ€ë¡œ ì ì¹˜ê¸°</button>
    </div>

    <div id="loading-screen" class="hidden">
        <img src="https://i.imgur.com/PZ7sH6p.png" alt="Loading" class="loading-icon" id="loading-img">
        <p class="loading-text" id="loading-msg">ìš´ì„¸ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>

    <div id="result-area" class="hidden">
        </div>
</div>

<script>
    // --- ì„¤ì • ê´€ë¦¬ ---
    const apiKeyInput = document.getElementById('api-key');
    const modelSelect = document.getElementById('model-select');

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
    window.onload = function() {
        const savedKey = localStorage.getItem('gemini_api_key');
        const savedModel = localStorage.getItem('gemini_model');
        
        if (savedKey) apiKeyInput.value = savedKey;
        if (savedModel) modelSelect.value = savedModel;
    };

    function toggleSettings() {
        const area = document.getElementById('settings-area');
        area.classList.toggle('hidden');
    }

    function saveSettings() {
        localStorage.setItem('gemini_api_key', apiKeyInput.value);
        localStorage.setItem('gemini_model', modelSelect.value);
        alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        document.getElementById('settings-area').classList.add('hidden');
    }

    // --- íƒ­ ì „í™˜ ---
    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        if (tab === 'saju') {
            document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
            document.getElementById('saju-form').classList.remove('hidden');
            document.getElementById('tarot-form').classList.add('hidden');
        } else {
            document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
            document.getElementById('saju-form').classList.add('hidden');
            document.getElementById('tarot-form').classList.remove('hidden');
        }
        document.getElementById('result-area').classList.add('hidden');
    }

    // --- ë¡œë”© í™”ë©´ ì œì–´ ---
    // íŒë‹¤, ê³ ì–‘ì´ ë“± ì´ë¯¸ì§€ë¥¼ ëœë¤ í˜¹ì€ ìƒí™©ì— ë§ì¶° ë³€ê²½ (ì˜ˆì‹œ ì´ë¯¸ì§€ URL ì‚¬ìš©)
    const loadingImages = [
        "https://cdn-icons-png.flaticon.com/512/616/616430.png", // ê³ ì–‘ì´ ì˜ˆì‹œ
        "https://cdn-icons-png.flaticon.com/512/3069/3069172.png" // íŒë‹¤ ì˜ˆì‹œ
    ];
    
    function showLoading(msg) {
        const screen = document.getElementById('loading-screen');
        const img = document.getElementById('loading-img');
        const txt = document.getElementById('loading-msg');
        
        // ëœë¤ ì´ë¯¸ì§€ ì„ íƒ (íŒë‹¤ or ê³ ì–‘ì´)
        const randomIdx = Math.floor(Math.random() * loadingImages.length);
        img.src = loadingImages[randomIdx];
        
        txt.innerText = msg;
        screen.classList.remove('hidden');
    }

    function hideLoading() {
        document.getElementById('loading-screen').classList.add('hidden');
    }

    // --- API í˜¸ì¶œ í•¨ìˆ˜ (ê³µí†µ) ---
    async function callGemini(prompt) {
        const apiKey = apiKeyInput.value;
        const model = modelSelect.value || "gemini-1.5-pro";

        if (!apiKey) {
            alert("ì„¤ì •ì—ì„œ API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return null;
        }

        const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }]
                })
            });

            const data = await response.json();
            if (data.error) {
                throw new Error(data.error.message);
            }
            return data.candidates[0].content.parts[0].text;

        } catch (error) {
            console.error(error);
            alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
            return null;
        }
    }

    // --- ì‚¬ì£¼ ë¡œì§ ---
    async function runSaju() {
        const name = document.getElementById('saju-name').value;
        const birth = document.getElementById('saju-birth').value;
        const time = document.getElementById('saju-time').value;
        const gender = document.getElementById('saju-gender').value;
        const query = document.getElementById('saju-query').value;

        if (!name || !birth) {
            alert("ì´ë¦„ê³¼ ìƒë…„ì›”ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
            return;
        }

        showLoading("ì‚¬ì£¼íŒ”ìë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...\nì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.");

        const prompt = `
        ì—­í• : ë‹¹ì‹ ì€ í•œêµ­ ìµœê³ ì˜ ëª…ë¦¬í•™ìì…ë‹ˆë‹¤.
        ì‚¬ìš©ì ì •ë³´:
        - ì´ë¦„: ${name}
        - ìƒë…„ì›”ì¼: ${birth}
        - íƒœì–´ë‚œ ì‹œê°„: ${time || "ëª¨ë¦„"}
        - ì„±ë³„: ${gender}
        - ê³ ë¯¼: ${query}

        ìš”ì²­ì‚¬í•­:
        1. ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì‚¬ì£¼íŒ”ìë¥¼ ë¶„ì„í•´ì¤˜.
        2. ì„±ê²©, ì¬ë¬¼ìš´, ì§ì—…ìš´, ì—°ì• ìš´ì„ ê°„ë‹¨ëª…ë£Œí•˜ê²Œ ì„¤ëª…í•´ì¤˜.
        3. ê³ ë¯¼ì— ëŒ€í•œ í˜„ì‹¤ì ì´ê³  ë”°ëœ»í•œ ì¡°ì–¸ì„ í•´ì¤˜.
        4. ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ë³´ê¸° ì¢‹ê²Œ ì¶œë ¥í•´ì¤˜.
        `;

        const result = await callGemini(prompt);
        hideLoading();

        if (result) {
            const resultArea = document.getElementById('result-area');
            resultArea.innerHTML = marked.parse(result); // Markdown íŒŒì‹±
            resultArea.classList.remove('hidden');
        }
    }

    // --- íƒ€ë¡œ ë¡œì§ ---
    async function runTarot() {
        const query = document.getElementById('tarot-query').value;
        const method = document.getElementById('tarot-method').value;

        if (!query) {
            alert("ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        showLoading("ì¹´ë“œë¥¼ ì„ê³  ìš´ëª…ì„ ì½ê³  ìˆìŠµë‹ˆë‹¤...\níŒë‹¤ê°€ ëŒ€ë‚˜ë¬´ ìì„ ì½ê³  ìˆë‹¤ íŒë‹¤...");

        const prompt = `
        ì—­í• : ë‹¹ì‹ ì€ ì‹ ë¹„ë¡œìš´ íƒ€ë¡œ ë§ˆìŠ¤í„°ì…ë‹ˆë‹¤.
        ì‚¬ìš©ì ì§ˆë¬¸: "${query}"
        ìŠ¤í”„ë ˆë“œ ë°©ì‹: ${method}

        ìš”ì²­ì‚¬í•­:
        1. ì§ˆë¬¸ì— ë§ì¶° ê°€ìƒì˜ íƒ€ë¡œ ì¹´ë“œë¥¼ ë½‘ì•„ì¤˜ (ë°©ì‹ì— ë§ê²Œ 1ì¥ ë˜ëŠ” 3ì¥).
        2. ë½‘íŒ ì¹´ë“œì˜ ì´ë¦„ê³¼ ì •ë°©í–¥/ì—­ë°©í–¥ ì—¬ë¶€ë¥¼ ì•Œë ¤ì¤˜.
        3. ê° ì¹´ë“œì˜ ì˜ë¯¸ì™€ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì„ ì—°ê²°í•´ì„œ í•´ì„í•´ì¤˜.
        4. ì‹ ë¹„ë¡­ê³  í¬ë§ì ì¸ ì–´ì¡°ë¡œ ë§í•´ì¤˜.
        5. ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥í•´ì¤˜.
        `;

        const result = await callGemini(prompt);
        hideLoading();

        if (result) {
            const resultArea = document.getElementById('result-area');
            resultArea.innerHTML = marked.parse(result);
            resultArea.classList.remove('hidden');
        }
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

</body>
</html>
